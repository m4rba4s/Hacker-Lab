<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ”§ Hacker Lab Diagnostics</title>
    <style>
        body {
            background: #0a0e1a;
            color: #49f7c2;
            font-family: 'Courier New', monospace;
            padding: 20px;
            margin: 0;
            line-height: 1.6;
        }
        h1 {
            text-shadow: 0 0 20px currentColor;
            text-align: center;
        }
        .test-section {
            background: rgba(0,0,0,0.5);
            border: 1px solid #49f7c2;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-result {
            padding: 5px 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .pass {
            background: rgba(77, 243, 163, 0.2);
            color: #4df3a3;
        }
        .fail {
            background: rgba(255, 92, 122, 0.2);
            color: #ff5c7a;
        }
        .warn {
            background: rgba(255, 211, 110, 0.2);
            color: #ffd36e;
        }
        .info {
            background: rgba(126, 168, 255, 0.2);
            color: #7ea8ff;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #49f7c2;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4df3a3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ HACKER LAB DIAGNOSTICS ğŸ”§</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š Environment Check</h2>
        <div id="env-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“¦ Module Loading Test</h2>
        <div id="module-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” Console Output</h2>
        <pre id="console-output"></pre>
    </div>
    
    <div class="test-section">
        <h2>ğŸš€ Actions</h2>
        <button onclick="window.location.href='index.html'">Open Main App</button>
        <button onclick="window.location.href='test_simple.html'">Simple Test</button>
        <button onclick="window.location.href='run_tests.html'">Run Full Tests</button>
        <button onclick="location.reload()">Reload Diagnostics</button>
    </div>
    
    <script>
        // Override console to capture output
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        
        function captureConsole(method, text, isError = false) {
            method.apply(console, [text]);
            const line = document.createElement('div');
            line.style.color = isError ? '#ff5c7a' : '#49f7c2';
            line.textContent = text;
            consoleOutput.appendChild(line);
        }
        
        console.log = (...args) => captureConsole(originalLog, args.join(' '));
        console.error = (...args) => captureConsole(originalError, args.join(' '), true);
        
        // Environment tests
        function runEnvTests() {
            const envDiv = document.getElementById('env-tests');
            
            function addResult(text, status = 'info') {
                const div = document.createElement('div');
                div.className = `test-result ${status}`;
                div.textContent = text;
                envDiv.appendChild(div);
            }
            
            // Protocol check
            if (window.location.protocol === 'file:') {
                addResult('âŒ Running from file:// - ES6 modules will NOT work!', 'fail');
                addResult('â¡ï¸ Use http://localhost:8000 instead', 'warn');
            } else {
                addResult('âœ… Running from ' + window.location.protocol, 'pass');
            }
            
            // Browser check
            addResult('ğŸŒ Browser: ' + navigator.userAgent.substring(0, 50) + '...', 'info');
            
            // ES6 support
            try {
                eval('const test = () => {}; `template`; class Test {}');
                addResult('âœ… ES6 syntax supported', 'pass');
            } catch (e) {
                addResult('âŒ ES6 syntax NOT supported', 'fail');
            }
            
            // Module support
            if ('noModule' in HTMLScriptElement.prototype) {
                addResult('âœ… ES6 modules supported', 'pass');
            } else {
                addResult('âŒ ES6 modules NOT supported', 'fail');
            }
            
            // Local storage
            try {
                localStorage.setItem('test', '1');
                localStorage.removeItem('test');
                addResult('âœ… LocalStorage available', 'pass');
            } catch (e) {
                addResult('âš ï¸ LocalStorage not available', 'warn');
            }
        }
        
        // Module loading tests
        async function runModuleTests() {
            const modDiv = document.getElementById('module-tests');
            
            function addResult(text, status = 'info') {
                const div = document.createElement('div');
                div.className = `test-result ${status}`;
                div.textContent = text;
                modDiv.appendChild(div);
            }
            
            // Test loading app.js
            try {
                addResult('â³ Loading app.js...', 'info');
                const appModule = await import('./assets/js/app.js');
                addResult('âœ… app.js loaded successfully', 'pass');
                
                if (window.HackerLabApp) {
                    addResult('âœ… HackerLabApp is available globally', 'pass');
                    addResult('ğŸ“‹ State: ' + (window.HackerLabApp.state.initialized ? 'Initialized' : 'Not initialized'), 
                             window.HackerLabApp.state.initialized ? 'pass' : 'warn');
                } else {
                    addResult('âŒ HackerLabApp NOT found in window', 'fail');
                }
            } catch (error) {
                addResult('âŒ Failed to load app.js', 'fail');
                addResult('Error: ' + error.message, 'fail');
                console.error(error);
            }
            
            // Test individual modules
            const modules = [
                'assets/js/core/state.js',
                'assets/js/core/simulator.js',
                'assets/js/ui/terminal.js',
                'assets/data/lessons.js'
            ];
            
            for (const modulePath of modules) {
                try {
                    addResult(`â³ Loading ${modulePath}...`, 'info');
                    await import('./' + modulePath);
                    addResult(`âœ… ${modulePath} loaded`, 'pass');
                } catch (error) {
                    addResult(`âŒ ${modulePath} failed: ${error.message}`, 'fail');
                }
            }
        }
        
        // Run all tests
        console.log('ğŸ”§ Starting diagnostics...');
        runEnvTests();
        runModuleTests().then(() => {
            console.log('âœ… Diagnostics complete!');
        }).catch(error => {
            console.error('âŒ Diagnostics failed:', error);
        });
        
        // Global error handler
        window.addEventListener('error', (e) => {
            console.error('ğŸ’€ Global error:', e.message);
        });
    </script>
</body>
</html>
